{% extends 'base.html' %}

{% block title %}Create Administrator - Superuser Panel{% endblock %}

{% block extra_css %}
<style>
    .superuser-header {
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white;
        padding: 2rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }
    .form-section {
        background: white;
        border-radius: 8px;
        padding: 2rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border: 2px solid #dc3545;
    }
    .warning-box {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 2rem;
    }
    .privilege-info {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="superuser-header text-center">
        <h2><i class="fas fa-user-plus"></i> Create New Administrator</h2>
        <p class="mb-0">Create a new user with administrative privileges</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Warning Box -->
            <div class="warning-box">
                <h6><i class="fas fa-exclamation-triangle text-warning"></i> Important Notice</h6>
                <p class="mb-0">
                    You are creating a user with administrative privileges. Administrators can manage 
                    communities, categories, users, and system settings. Only create admin accounts 
                    for trusted individuals.
                </p>
            </div>

            <!-- Privilege Information -->
            <div class="privilege-info">
                <h6><i class="fas fa-shield-alt text-danger"></i> Administrator Privileges</h6>
                <ul class="mb-0 small">
                    <li>Manage communities (create, edit, activate/deactivate)</li>
                    <li>Manage alert categories (create, edit, activate/deactivate)</li>
                    <li>Manage users (view, edit roles, manage community memberships)</li>
                    <li>Access Django admin panel (staff access)</li>
                    <li>View system statistics and reports</li>
                </ul>
            </div>

            <div class="form-section">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Username -->
                    <div class="mb-3">
                        <label for="{{ form.username.id_for_label }}" class="form-label">
                            <i class="fas fa-user text-danger"></i> Username <span class="text-danger">*</span>
                        </label>
                        {{ form.username }}
                        {% if form.username.errors %}
                            <div class="text-danger small mt-1">{{ form.username.errors.0 }}</div>
                        {% endif %}
                        <div class="form-text">
                            Choose a unique username for the administrator. This will be used for login.
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="mb-3">
                        <label for="{{ form.email.id_for_label }}" class="form-label">
                            <i class="fas fa-envelope text-danger"></i> Email Address <span class="text-danger">*</span>
                        </label>
                        {{ form.email }}
                        {% if form.email.errors %}
                            <div class="text-danger small mt-1">{{ form.email.errors.0 }}</div>
                        {% endif %}
                        <div class="form-text">
                            Administrator email address for notifications and account recovery.
                        </div>
                    </div>

                    <!-- Name Fields -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.first_name.id_for_label }}" class="form-label">
                                <i class="fas fa-id-card text-danger"></i> First Name
                            </label>
                            {{ form.first_name }}
                            {% if form.first_name.errors %}
                                <div class="text-danger small mt-1">{{ form.first_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.last_name.id_for_label }}" class="form-label">
                                <i class="fas fa-id-card text-danger"></i> Last Name
                            </label>
                            {{ form.last_name }}
                            {% if form.last_name.errors %}
                                <div class="text-danger small mt-1">{{ form.last_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Password Fields -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.password1.id_for_label }}" class="form-label">
                                <i class="fas fa-lock text-danger"></i> Password <span class="text-danger">*</span>
                            </label>
                            {{ form.password1 }}
                            {% if form.password1.errors %}
                                <div class="text-danger small mt-1">{{ form.password1.errors.0 }}</div>
                            {% endif %}
                            <div class="form-text">{{ form.password1.help_text }}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.password2.id_for_label }}" class="form-label">
                                <i class="fas fa-lock text-danger"></i> Confirm Password <span class="text-danger">*</span>
                            </label>
                            {{ form.password2 }}
                            {% if form.password2.errors %}
                                <div class="text-danger small mt-1">{{ form.password2.errors.0 }}</div>
                            {% endif %}
                            <div class="form-text">{{ form.password2.help_text }}</div>
                        </div>
                    </div>

                    <!-- Account Details -->
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle"></i> Automatic Settings</h6>
                        <p class="mb-0 small">
                            The following settings will be automatically configured for the new administrator:
                        </p>
                        <ul class="mb-0 small mt-2">
                            <li><strong>Role:</strong> Administrator</li>
                            <li><strong>Staff Status:</strong> Yes (Django admin access)</li>
                            <li><strong>Email Notifications:</strong> Enabled</li>
                            <li><strong>Push Notifications:</strong> Enabled</li>
                            <li><strong>Account Status:</strong> Active</li>
                        </ul>
                    </div>

                    <!-- Buttons -->
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'superuser_dashboard' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-user-plus"></i> Create Administrator
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Form validation feedback
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const password1 = document.getElementById('{{ form.password1.id_for_label }}');
        const password2 = document.getElementById('{{ form.password2.id_for_label }}');
        
        // Real-time password confirmation validation
        function validatePasswordMatch() {
            if (password2.value && password1.value !== password2.value) {
                password2.setCustomValidity("Passwords don't match");
            } else {
                password2.setCustomValidity('');
            }
        }
        
        password1.addEventListener('input', validatePasswordMatch);
        password2.addEventListener('input', validatePasswordMatch);
        
        // Form submission confirmation
        form.addEventListener('submit', function(e) {
            const username = document.getElementById('{{ form.username.id_for_label }}').value;
            if (!confirm(`Are you sure you want to create administrator account for "${username}"?`)) {
                e.preventDefault();
            }
        });
    });
</script>
{% endblock %}