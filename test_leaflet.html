<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Leaflet Implementation</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        #testMap {
            height: 400px;
            width: 100%;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2><i class="fas fa-map"></i> OpenStreetMap + Leaflet.js Test</h2>
        <p class="text-muted">Testing the replacement of Google Maps with OpenStreetMap and Leaflet.js</p>
        
        <div class="card">
            <div class="card-header">
                <h5>Interactive Map Test</h5>
            </div>
            <div class="card-body">
                <div id="testMap"></div>
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="addTestMarker()">
                        <i class="fas fa-map-marker-alt"></i> Add Test Marker
                    </button>
                    <button class="btn btn-secondary" onclick="centerMap()">
                        <i class="fas fa-crosshairs"></i> Center Map
                    </button>
                    <button class="btn btn-info" onclick="toggleSatellite()">
                        <i class="fas fa-satellite"></i> Toggle Satellite
                    </button>
                </div>
                <div class="mt-3">
                    <p id="status" class="text-success">‚úÖ Leaflet map loaded successfully!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        let map;
        let testMarkers = [];
        let isSatelliteView = false;
        let osmLayer, satelliteLayer;
        
        // Initialize map
        function initMap() {
            // Default location (New York City)
            const defaultLocation = [40.7589, -73.9851];
            
            // Initialize map
            map = L.map('testMap').setView(defaultLocation, 13);
            
            // Define tile layers
            osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            });
            
            satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '¬© Esri, Maxar, Earthstar Geographics'
            });
            
            // Add default layer
            osmLayer.addTo(map);
            
            // Add click listener
            map.on('click', function(e) {
                addMarkerAt(e.latlng.lat, e.latlng.lng);
            });
            
            document.getElementById('status').innerHTML = '‚úÖ Leaflet map loaded successfully! Click on the map to add markers.';
        }
        
        function addTestMarker() {
            // Add marker at center of current view
            const center = map.getCenter();
            addMarkerAt(center.lat, center.lng);
        }
        
        function addMarkerAt(lat, lng) {
            // Create custom marker icon
            const alertIcon = L.divIcon({
                html: '<div style="background: #dc3545; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">!</div>',
                iconSize: [30, 30],
                iconAnchor: [15, 15],
                className: 'alert-marker'
            });
            
            const marker = L.marker([lat, lng], { icon: alertIcon }).addTo(map);
            
            marker.bindPopup(`
                <div style="text-align: center;">
                    <h6 style="color: #dc3545; margin-bottom: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> Test Alert
                    </h6>
                    <p><strong>Location:</strong><br>${lat.toFixed(6)}, ${lng.toFixed(6)}</p>
                    <button onclick="removeThisMarker()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                        Remove Marker
                    </button>
                </div>
            `).openPopup();
            
            testMarkers.push(marker);
            
            // Update status
            document.getElementById('status').innerHTML = `‚úÖ Added marker #${testMarkers.length} at ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
        }
        
        function centerMap() {
            map.setView([40.7589, -73.9851], 13);
            document.getElementById('status').innerHTML = '‚úÖ Map centered on New York City';
        }
        
        function toggleSatellite() {
            isSatelliteView = !isSatelliteView;
            
            if (isSatelliteView) {
                map.removeLayer(osmLayer);
                satelliteLayer.addTo(map);
                document.getElementById('status').innerHTML = 'üõ∞Ô∏è Switched to satellite view';
            } else {
                map.removeLayer(satelliteLayer);
                osmLayer.addTo(map);
                document.getElementById('status').innerHTML = 'üó∫Ô∏è Switched to street map view';
            }
        }
        
        function removeThisMarker() {
            // This would be called from popup - simplified for demo
            if (testMarkers.length > 0) {
                const lastMarker = testMarkers.pop();
                map.removeLayer(lastMarker);
                document.getElementById('status').innerHTML = `‚úÖ Removed marker. ${testMarkers.length} markers remaining.`;
            }
        }
        
        // Initialize map when page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof L !== 'undefined') {
                initMap();
            } else {
                document.getElementById('status').innerHTML = '‚ùå Failed to load Leaflet.js';
            }
        });
    </script>
</body>
</html>